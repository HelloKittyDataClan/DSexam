from pandas import read_csv, Series
from rdflib import RDF
from rdflib import Graph, URIRef, RDF, Literal, Namespace

class Handler: 
    def __init__(self): 
        self.dbPathOrUrl = "" 

    def getDbPathOrUrl(self): 
        return self.dbPathOrUrl  

    def setDbPathOrUrl(self, newpath): 
        if len(newpath.split('.')) and newpath.split('.')[-1] == "db": 
            self.dbPathOrUrl = newpath 
            return True 
        elif len(up.urlparse(newpath).scheme) and len(up.urlparse(newpath).netloc): 
            self.dbPathOrUrl = newpath 
            return True 
        return False 
 

class UploadHandler(Handler): 
    def __init__(self): 
        super().__init__() 

    def pushDataToDb(self): 
        pass 

class MetadataUploadHandler(UploadHandler):
    def pushDataToDb(self, path):

    #define namespaces
    schema = Namespace("http://schema.org/")
    foaf = Namespace ("http://xmlns.com/foaf/0.1/")  #related to person
    my_git = Namespace ("http://github.com/HelloKittyDataClan/DSexam")
   
    #create Graph
    meta_graph = Graph()
    meta_graph.bind = ("schema", schema)
    meta_graph.bind = ("foaf", schema)
    meta_graph.bind = ("git", my_git)

  # attributes related to classes
    title = URIRef("https://schema.org/title")
    date = URIRef("https://schema.org/dateCreated")
    owner = URIRef("http://github.com/HelloKittyDataClan/DSexam/owner")
    place = URIRef("https://schema.org/itemLocation")

    identifier=URIRef("https://schema.org/identifier")

    #relation with authors among classes
    author=URIRef("https://schema.org/author")

    #attributes related to the class Person
    name=URIRef("<http://xmlns.com/foaf/0.1/name>")

    #definie classes about Cultural Object
    Person = URIRef(foaf.Person)
    NauticalChart = URIRef(my_git.NauticalChart)
    ManuscriptPlate = URIRef(my_git.ManuscriptPlate)
    ManuscriptVolume = URIRef(my_git.ManuscriptVolume)
    PrintedVolume = URIRef(my_git.PrintedVolume)
    PrintedMaterial = URIRef(my_git.PrintedMaterial)
    Herbarium = URIRef(my_git.Herbarium)
    Specimen = URIRef(my_git.Specimen)
    Painting = URIRef(my_git.Painting) 
    Model = URIRef(my_git.Model)
    Map = URIRef(schema.Map)

# This is the string defining the base URL used to defined
# the URLs of all the resources created from the data
    base_url = Namespace ("http://github.com/HelloKittyDataClan/DSexam")

    venus=read_csv(".../data/meta.csv",
                    path,
                    keep_default_na=False,
                        dtype={
                        "Id": "string",
                        "Title": "string",
                        "Date" : "string",
                        "Owner": "string",
                        "Place": "string",
                        "Type":"string"
                        "Author": "string"
                        }
                )

    for idx, row in venus.iterrows():   #mi restituisce un indice e un row che contiene i valori delle colonne
        internal_id = "culturalobject-" + str(idx)  
        subject = URIRef(base_url + internal_id)

        if row["Id"] != "":
            meta_graph.add(subject, identifier, Literal (row["Id"]))

        if row["Title"] != "":
            meta_graph.add(subject, title, Literal(row["Title"]))

        if row["Date"] != "":
            meta_graph.add(subject, date, Literal (row["Date"]))
        
        if row["Owner"] != "":
            meta_graph.add(subject, owner, Literal (row["Owner"]))
        
        if row["Place"] != "":
            meta_graph.add(subject, place, Literal (row["Place"]))

        # add to a Graph the Cultural Object
        if row["Type"] != "":
            if row["Type"].lower()=="nautical chart":
                meta_graph.add((subject, RDF.type, NauticalChart))

            elif row["Type"].lower()=="manuscript plate":
                meta_graph.add((subject, RDF.type, ManuscriptPlate))
    
            elif row["Type"].lower()=="manuscript volume":
                meta_graph.add((subject, RDF.type, ManuscriptVolume))
    
            elif row["Type"].lower()=="printed volume":
                meta_graph.add((subject, RDF.type, PrintedVolume))

            elif row["Type"].lower()=="printed material":
                meta_graph.add((subject, RDF.type, PrintedMaterial))

            elif row["Type"].lower()=="herbarium":
                meta_graph.add((subject, RDF.type, Herbarium))

            elif row["Type"].lower()=="specimen":
                meta_graph.add((subject, RDF.type, Specimen))

            elif row["Type"].lower()=="painting":
                meta_graph.add((subject, RDF.type, Painting))

            elif row["Type"].lower()=="model":
                meta_graph.add((subject, RDF.type, Model))
        
            elif row["Type"].lower()=="map":
                meta_graph.add((subject, RDF.type, Map))

            #add author

    

            

    

